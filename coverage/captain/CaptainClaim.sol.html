<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for captain\CaptainClaim.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">captain/</a> CaptainClaim.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">20% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>9/45</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/18</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">4.76% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>1/21</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">17.65% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>9/51</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "../interfaces/ICaptainClaim.sol";
import "../interfaces/IKakiCaptain.sol";
import "../base/WithRandom.sol";
import "../base/BaseERC721.sol";
import "../base/WithAdminRole.sol";
import "../interfaces/IAddressList.sol";
import "../interfaces/IMysteryBox.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
&nbsp;
contract CaptainClaim is ICaptainClaim, WithRandom, WithAdminRole {
    mapping(address =&gt; bool) _claim;
    mapping(address =&gt; uint256) _claimTimeLimit;
    mapping(address =&gt; uint256) _mintTimeLimit;
&nbsp;
    IERC20 _busd;
    IKakiCaptain public _captain;
    IMysteryBox public _mysBox;
    IAddressList _addressList;
    IAddressList _mintList;
&nbsp;
    bool _able;
    bool _switchAble;
    uint256[] tokenIdList;
    uint256 public _count;
    uint256 public _limit;
    uint256 public _mintPrice;
    uint256 public _mintLimit;
    uint256 public _claimLimit;
    uint256 public _foundationRate;
    address public _kakiFoundation;
    address constant BlackHole = 0x0000000000000000000000000000000000000000;
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyNoneContract() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == tx.origin, "only non contract call")</span>;
        _;
    }
&nbsp;
    receive() external payable {}
&nbsp;
    function initialize(IKakiCaptain capAdd, IMysteryBox mysBoxAdd, IRandoms radomAdd) public initializer {
        __WithAdminRole_init();
        __WithRandom_init(radomAdd);
        _captain = capAdd;
        _mysBox = mysBoxAdd;
        _mintPrice = 0.5 ether;
        _claimLimit = 1;
        _mintLimit = 2;
        _limit = 210;
        _kakiFoundation = 0x958f0991D0e847C06dDCFe1ecAd50ACADE6D461d; // kaki foundation address
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isAble() {</span>
<span class="cstat-no" title="statement not covered" >        require(!_able, "Lock is enabled.")</span>;
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier isSwitchAble() {</span>
<span class="cstat-no" title="statement not covered" >        require(!_switchAble, "Claim had ended.")</span>;
        _;
    }
&nbsp;
    // function claim() public override isClaimOver onlyNoneContract {
    //     require(_addressList.isInAddressList(msg.sender), "Not allow.");
    //     require(_claimTimeLimit[msg.sender] &lt; _claimLimit, "Claim too much.");
    //     uint256 tokenId = getRandId();
    //     uint256 rad = random(1, 3);
    //     _captain.mint(msg.sender, tokenId, rad);
    //     _claimTimeLimit[msg.sender]++;
    //     emit Claim(msg.sender, tokenId);
    // }
&nbsp;
<span class="fstat-no" title="function not covered" >    function mint() public override payable isAble onlyNoneContract returns(uint256 tokenId) {</span>
        //require(_mintList.isInAddressList(msg.sender), "Not allow.");
<span class="cstat-no" title="statement not covered" >        require(msg.value == _mintPrice, "BNB not enough")</span>;
<span class="cstat-no" title="statement not covered" >        require(_count &lt; _limit, "over")</span>; 
<span class="cstat-no" title="statement not covered" >        require(_mintTimeLimit[msg.sender] &lt; _mintLimit, "Mint too much.")</span>;
<span class="cstat-no" title="statement not covered" >        tokenId = getRandId()</span>;
<span class="cstat-no" title="statement not covered" >        _captain.mint(msg.sender, tokenId)</span>;
        _count++;
        _mintTimeLimit[msg.sender]++;
<span class="cstat-no" title="statement not covered" >        emit Mint(msg.sender, tokenId);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function switchByBox(uint256 boxId) public override isSwitchAble onlyNoneContract returns(uint256 tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        _mysBox.safeTransferFrom(msg.sender, address(0xdead), boxId)</span>;
<span class="cstat-no" title="statement not covered" >        tokenId = getRandId()</span>;
<span class="cstat-no" title="statement not covered" >        _captain.mint(msg.sender, tokenId)</span>;
        _count++;
<span class="cstat-no" title="statement not covered" >        emit Mint(msg.sender, tokenId);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getRandId() internal returns(uint256 tokenId) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 tokenIndex = random(0, tokenIdList.length);</span>
<span class="cstat-no" title="statement not covered" >        tokenId = tokenIdList[tokenIndex]</span>;
<span class="cstat-no" title="statement not covered" >        tokenIdList[tokenIndex] = tokenIdList[tokenIdList.length - 1]</span>;
<span class="cstat-no" title="statement not covered" >        tokenIdList.pop()</span>;
    }
&nbsp;
    //****************************** view ***************************************** */
<span class="fstat-no" title="function not covered" >    function getList() public view override returns(uint256[] memory idList) {</span>
<span class="cstat-no" title="statement not covered" >        idList = tokenIdList</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getTotalMint() public view override returns(uint256 count) {</span>
<span class="cstat-no" title="statement not covered" >        count = _count</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getMintTime() public view override returns(uint256 mintTime) { </span>
<span class="cstat-no" title="statement not covered" >        mintTime = _mintTimeLimit[msg.sender]</span>;
    }
&nbsp;
    //****************************** admin function ***************************************** */
<span class="fstat-no" title="function not covered" >    function setTokenIdList(uint256 start, uint256 end) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        for(uint256 i = start; i &lt;= end; i++) {</span>
<span class="cstat-no" title="statement not covered" >            tokenIdList.push(i)</span>;
        }
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setTicketPrice(uint256 mintPrice) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _mintPrice = mintPrice</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setCapAdd(address capAdd) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _captain = IKakiCaptain(capAdd)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setLimit(uint256 newLimit) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _limit = newLimit</span>;
    }
&nbsp;
    // function setClaimWhiteList(IAddressList allowList) public onlyOwner {
    //     _addressList = allowList;
    // }
&nbsp;
    // function setMintWhiteList(IAddressList mintList) public onlyOwner {
    //     _addressList = mintList;
    // }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setSwitchAble() public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _switchAble = !_switchAble</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setAble() public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _able = !_able</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setClaimLimit(uint256 newClaimLimit) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(newClaimLimit &gt; 0, "Invalid limit number")</span>;
<span class="cstat-no" title="statement not covered" >        _claimLimit = newClaimLimit</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setFoundAdd(address newFoundAdd) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(newFoundAdd != BlackHole, "Invalid address")</span>;
<span class="cstat-no" title="statement not covered" >        _kakiFoundation = newFoundAdd</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function sendToFoundation() public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        uint256 amount = address(this).balance;</span>
<span class="cstat-no" title="statement not covered" >        (bool success, ) = _kakiFoundation.call{ value: amount }(new bytes(0));</span>
<span class="cstat-no" title="statement not covered" >        require(success, "! safe transfer bnb")</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setMysteryAdd(IMysteryBox newMybox) public onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        _mysBox = newMybox</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function version() public pure returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return 9;</span>
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jan 13 2022 15:44:47 GMT+0800 (中国标准时间)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
